# Инструкция по настройке Telegram бота для бэкапа

## Шаг 1: Создание бота в Telegram

1. Откройте Telegram и найдите бота @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям BotFather:
   - Введите имя для бота (например, "My Backup Bot")
   - Введите username для бота (должен заканчиваться на "bot", например "my_backup_bot")
4. После создания бота, BotFather отправит вам сообщение с токеном бота. Это строка вида:
   ```
   123456789:ABCdefGhIJKlmNoPQRsTUVwxyZ
   ```
5. **Важно**: Сохраните этот токен, он понадобится для настройки скрипта

## Шаг 2: Настройка бота

1. Отправьте боту несколько сообщений, чтобы активировать его
2. Откройте диалог с созданным ботом
3. Отправьте команду `/start`

## Шаг 3: Настройка скрипта Google Apps Script

1. Откройте свою Google Таблицу
2. Перейдите в меню Extensions → Apps Script
3. Замените содержимое открывшегося файла `Code.gs` кодом из файла [Code.gs](Code.gs) этого репозитория
4. В коде найдите строку:
   ```javascript
   const TELEGRAM_BOT_TOKEN = 'YOUR_TELEGRAM_BOT_TOKEN';
   ```
5. Замените `YOUR_TELEGRAM_BOT_TOKEN` на токен, полученный от BotFather
6. Сохраните скрипт (Ctrl + S или File → Save)
7. Закройте редактор скриптов
8. Перезагрузите таблицу

## Шаг 4: Первоначальная настройка

1. После перезагрузки таблицы в меню появится пункт "Telegram Backup"
2. Выберите "Telegram Backup → Настроить папки"
3. Подтвердите создание папок на Google Drive
4. Разрешите скрипту доступ к вашим данным, если будет запрос

## Шаг 5: Пересылка избранных сообщений боту

1. Откройте Telegram на вашем устройстве
2. Перейдите в "Сохраненные сообщения" (Избранное)
3. Выберите сообщения, которые хотите сохранить
4. Используйте функцию "Переслать" (Forward) и выберите вашего бота в качестве получателя
5. Вы можете пересылать сразу несколько сообщений

## Шаг 6: Запуск бэкапа

1. Вернитесь в Google Таблицу
2. Выберите "Telegram Backup → Сделать бэкап"
3. Подождите, пока скрипт выполнит свою работу
4. После завершения вы увидите уведомление с результатами бэкапа
5. Подробный лог операций можно увидеть на листе "Backup Logs" в вашей таблице

## Примечания

- Скрипт обрабатывает до 30 файлов за один запуск
- Поддерживаются следующие типы файлов: фото, видео, документы, аудио, голосовые сообщения
- Все файлы сортируются по типам и сохраняются в соответствующие папки
- Если вы не видите файлы в Google Drive, убедитесь, что у скрипта есть необходимые разрешения

## Частые проблемы и их решения

### Ошибка "Telegram API вернул ошибку"
- Убедитесь, что вы правильно ввели токен бота
- Проверьте, активирован ли бот (отправьте ему сообщение /start)

### Ошибка "Недостаточно прав для доступа к Google Drive"
- При первом запуске скрипт запросит разрешения на доступ к Google Drive
- Убедитесь, что вы подтвердили все запрашиваемые разрешения

### Файлы не сохраняются в правильные папки
- Выполните снова функцию "Настроить папки"
- Проверьте права доступа к папкам на Google Drive

### Скрипт работает слишком долго
- Уменьшите константу `MAX_FILES_TO_PROCESS` в коде скрипта
- Google Apps Script имеет ограничение по времени выполнения в 6 минут
